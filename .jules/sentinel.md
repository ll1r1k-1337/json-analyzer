## 2024-02-28 - [Memory Exhaustion via Unbounded Allocation]
**Vulnerability:** The `BinaryTokenReader` accepted arbitrary values for allocation length from untrusted metadata (`readBytes` without limit check). Additionally, `BinaryTokenWriter` did not enforce any constraints on the number of unique strings or the string table size.
**Learning:** Parsing files/streams requires strict validation on limits before making dynamic memory allocations. Otherwise, a maliciously constructed file can cause the application to exceed system bounds, leading to an immediate crash and denial of service. The same applies to limits around unbounded structures like string tables.
**Prevention:** Always implement maximum boundaries on inputs representing allocation sizes (e.g., limit readBytes to a safe max like 512MB) and provide configurable bounds for deduplicated entries (like string tables) that might consume excessive memory. Ensure bounds match file capacity (`offset + length <= source.size`).